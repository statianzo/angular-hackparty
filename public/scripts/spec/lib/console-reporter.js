define(function() {
  var console = window.console;
  var cross_icon = "data:image/png;base64,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";

  var check_icon = "data:image/png;base64,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"

  function canNotify() {
    return window.webkitNotifications && window.webkitNotifications.checkPermission() === 0;
  };

  function notify(str, title, icon) {
    if (!canNotify()) return;

    var note = window.webkitNotifications.createNotification(icon, title || 'Jasmine', str);
    note.ondisplay = function() {
      var self = this;
      var end = function () { note.close() };
      setTimeout(end, 5000);
      window.onbeforeunload = end;
    };
    note.show();
  }

  var ANSI = {}
  ANSI.color_map = {
      "green" : 32,
      "red"   : 31
  }

  ANSI.colorize_text = function(text, color) {
    var color_code = this.color_map[color];
    return "\033[" + color_code + "m" + text + "\033[0m";
  }
  
  var ConsoleReporter = function() {
    if (!console || !console.log) { throw "console isn't present!"; }
    this.status = this.statuses.stopped;
  };

  var proto = ConsoleReporter.prototype;
  proto.statuses = {
    stopped : "stopped",
    running : "running",
    fail    : "fail",
    success : "success"
  };

  proto.reportRunnerStarting = function(runner) {
    this.status = this.statuses.running;
    this.start_time = (new Date()).getTime();
    this.executed_specs = 0;
    this.passed_specs = 0;
  };

  proto.reportRunnerResults = function(runner) {
    var failed = this.executed_specs - this.passed_specs;
    var spec_str = this.executed_specs + (this.executed_specs === 1 ? " spec, " : " specs, ");
    var fail_str = failed + (failed === 1 ? " failure in " : " failures in ");
    var color = (failed > 0)? "red" : "green";
    var dur = (new Date()).getTime() - this.start_time;

    this.log("");
    this.log("Finished");
    this.log("-----------------");
    var last_str = spec_str + fail_str + (dur/1000) + "s."
    this.log(last_str, color);

    notify(last_str, failed ?  'Failure' : 'Success', failed ? cross_icon : check_icon);

    this.status = (failed > 0)? this.statuses.fail : this.statuses.success;

    /* Print something that signals that testing is over so that headless browsers
       like PhantomJs know when to terminate. */
    this.log("");
    this.log("ConsoleReporter finished");
  };


  proto.reportSpecStarting = function(spec) {
    this.executed_specs++;
  };

  proto.reportSpecResults = function(spec) {
    if (spec.results().passed()) {
      this.passed_specs++;
      return;
    }

    var resultText = spec.suite.description + " : " + spec.description;
    this.log(resultText, "red");

    var items = spec.results().getItems()
    for (var i = 0; i < items.length; i++) {
      var trace = items[i].trace.stack || items[i].trace;
      this.log(trace, "red");
    }
  };

  proto.reportSuiteResults = function(suite) {
    if (!suite.parentSuite) { return; }
    var results = suite.results();
    var failed = results.totalCount - results.passedCount;
    var color = (failed > 0)? "red" : "green";
    this.log(suite.description + ": " + results.passedCount + " of " + results.totalCount + " passed.", color);
  };

  proto.log = function(str, color) {
    var text = (color != undefined)? ANSI.colorize_text(str, color) : str;
    console.log(text)
  };

  return ConsoleReporter;
});
